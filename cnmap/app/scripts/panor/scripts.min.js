(function(){var a,b,c;a=function(a,b,c,d){var e,f,g,h;return e=Math.PI*a/180,f=Math.PI*b/180,g=Math.PI*c/180,h=Math.PI*d/180,6371e3*Math.acos(Math.min(Math.cos(e)*Math.cos(g)*Math.cos(f)*Math.cos(h)+Math.cos(e)*Math.sin(f)*Math.cos(g)*Math.sin(h)+Math.sin(e)*Math.sin(g),1))},window.cnmap=null!=(b=window.cnmap)?b:{},window.cnmap.GPS=null!=(c=window.cnmap.GPS)?c:{},window.cnmap.GPS.distanceInMeter=a}).call(this),function(){var a,b;a=function(){function a(a){var b;this.opts=a,this.opts&&(b=this.opts,this.ctx=b.ctx,this.map=b.map,this.travel=b.travel),this.mapEventListener=window.cnmap.MapEventListener.factory(),this.marker=this.createMarker()}return a.prototype.initMap=function(){},a.prototype.setMap=function(a){return a?(this.map=a,this.initMap()):void 0},a.prototype.setTravel=function(a){var b,c,d,e,f;for(this.travel=a,this.travel.spots.sort(function(a,b){return a.id-b.id}),e=this.travel.spots,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.photos.sort(function(a,b){return a.date_time-b.date_time}));return f},a.prototype.createLabel=function(){},a.prototype.getLabelContent=function(a){return"<img src='"+this.ctx+"/api/rest/photo/"+a+"/3' style='border: 2px solid white; width: 34px; height: 34px;'>"},a.prototype.activePhoto=function(a){return this.mapEventListener.inMapView(a.point.lat,a.point.lng,this.map)?(this.mapEventListener.setPosition(this.marker,a.point.lat,a.point.lng),this.mapEventListener.setCenter(this.map,a.point.lat,a.point.lng)):(this.mapEventListener.setPosition(this.marker,a.point.lat,a.point.lng),this.mapEventListener.setCenter(this.map,a.point.lat,a.point.lng),this.mapEventListener.setZoom(this.map,18))},a.prototype.createMarker=function(){},a.prototype.activeSpot=function(a){var b,c,d,e,f,g;if(a.photos[0]&&(d=jQuery.extend({},a.photos[0].point)),a.photos[1]&&(a.photos[1].point.lat<d.lat||a.photos[1].point.lng<d.lng?(b=d,d=jQuery.extend({},a.photos[1].point)):b=jQuery.extend({},a.photos[1].point)),d&&b){for(g=a.photos,e=0,f=g.length;f>e;e++)c=g[e],c.point.lat<d.lat&&(d.lat=c.point.lat),c.point.lng<d.lng&&(d.lng=c.point.lng),c.point.lat>b.lat&&(b.lat=c.point.lat),c.point.lng>b.lng&&(b.lng=c.point.lng);return this.mapEventListener.setBounds(this.map,d,b)}},a.prototype.clearMap=function(){return this.mapEventListener.clearMap(this.map)},a}(),window.cnmap=null!=(b=window.cnmap)?b:{},window.cnmap.ITravelLayer=a}.call(this),function(){var a;a=function(){function a(){}return a.prototype.opts={map:null},a.prototype.addLocationHashListener=function(){},a.prototype.addToolBar=function(){},a.prototype.setCenter=function(){},a.prototype.setZoom=function(){},a.prototype.setBounds=function(){},a.prototype.clearMap=function(){},a.prototype.inMapView=function(){},a.prototype.addMarker=function(){},a.prototype.createDraggableMarker=function(){},a.prototype.activeMarker=function(){},a.prototype.deactiveMarker=function(){},a.prototype.addMarkerActiveListener=function(){},a.prototype.addDragendListener=function(){},a.prototype.addMapClickListener=function(){},a.prototype.setPosition=function(){},a.prototype.setMap=function(){},a}(),window.cnmap=window.cnmap||{},window.cnmap.IMapEventListener=a}.call(this),function(){var a;a=function(){function a(){}return a.prototype.map=void 0,a.prototype.init=function(){},a.prototype.getAddress=function(){},a.prototype.getLocation=function(){},a}(),window.cnmap=window.cnmap||{},window.cnmap.IMapService=a}.call(this),function(a){"function"==typeof define&&define.amd?define([window,"jquery"],a):a(window,jQuery)}(function(a,b){a.cnmap=a.cnmap||{},a.cnmap.utils=a.cnmap.utils||{};var c,d;return a.cnmap.utils.getLocalCity=function(a){var c="http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js";b.getScript(c).done(function(){a.apply(null,[remote_ip_info.city])})},a.cnmap.GPS=a.cnmap.GPS||{},a.cnmap.GPS.convert=function(a){var b;if("string"==typeof a&&a.constructor==String){var c=a.search(/[0-9]+,[0-9]+,[0-9]+\.[0-9]+/);if(-1!==c){var d=a.split(",");b=Number(d[0])+(Number(d[1])+Number(d[2])/60)/60}else if(c=a.search(/[0-9]+°[0-9]+'([0-9]+|[0-9]+\.[0-9]+)"/),-1!==c){var d=a.split("°"),e=Number(d[0]);d=d[1].split("'");var f=Number(d[0]);d=d[1].split('"');var g=Number(d[0]);b=e+(f+g/60)/60}}else if("number"==typeof a&&a.constructor==Number){var e=Math.floor(a),f=Math.floor(60*(a-e)),g=60*(60*(a-e)-f);g=g.toPrecision(6),b=e+"°"+f+"'"+g+'"'}return b},a.cnmap.utils.baidu={geocoder:null,init:function(){this.geocoder=new BMap.Geocoder},convert:function(a,b,c){var d=new BMap.Point(b,a);BMap.Convertor.translate(d,0,c)},getGeoPoint:function(a,b){this.geocoder||this.init(),this.geocoder.getPoint(a,function(a){b.apply(null,a)})}},a.cnmap.utils.qq={geocoder:null,init:function(){this.geocoder=new qq.maps.Geocoder},getAddress:function(a,b,c){this.geocoder||this.init();var d=new qq.maps.LatLng(a,b);this.geocoder.setComplete(c),this.geocoder.getAddress(d)},getLocation:function(a,b){this.geocoder||this.init(),this.geocoder.setComplete(b),this.geocoder.getLocation(a)}},a.cnmap.utils.gaode={map:null,init:function(a){this.map.plugin(["AMap.Geocoder"],function(){c=new AMap.Geocoder({radius:1e3,extensions:"all"}),a&&a.apply(c,[c])})},getAddress:function(a,b,e){if(c){var f=new AMap.LngLat(b,a);d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",e),c.getAddress(f)}else this.init(function(c){var f=new AMap.LngLat(b,a);d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",e),c.getAddress(f)})},getLocation:function(a,b){c||this.init(),d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",b),c.getLocation(a)}},a.cnmap.utils.compareArray=function(a,c,d){if(a&&c){var e=b.unique(b.merge(b.merge([],a),c));b.each(e,function(e,f){b.inArray(f,a)>-1?b.inArray(f,c)>-1?d.apply(f,[null,f,null]):d.apply(f,[f,null,null]):b.inArray(f,c)>-1&&d.apply(f,[null,null,f])})}},a.cnmap}),function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a){return a.cnmap=a.cnmap||{},a.cnmap.Panoramio=function(a){var b,c={};this.opts=a||{},this.getBoundsThumbnails=function(a,d,e,f){var g=(this.clearVisible,this.setVisible,{nelat:a.ne.lat,nelng:a.ne.lng,swlat:a.sw.lat,swlng:a.sw.lng,level:d,vendor:this.opts&&this.opts.mapVendor||"gps",width:e.width,height:e.height});this.opts.latest&&(g.latest=!0),this.opts.userId&&(g.userId=this.opts.userId,this.opts.favorite&&(g.favorite=!!this.opts.favorite)),this.opts.tag&&(g.tag=this.opts.tag),b.photo.read(g).done(function(a){if("OK"==a.status){for(var b in a.photos)c[a.photos[b].photoId]||(c[a.photos[b].photoId]=a.photos[b]);f.apply(null,[a.photos])}})},this.getLabelContent=function(a){return this.opts.phone?"<img src='"+this.ctx+"/api/rest/photo/"+a+"/3' style='border: 2px solid white; width: 34px; height: 34px;'>":"<img src='"+this.ctx+"/api/rest/photo/"+a+"/3' style='border: 2px solid white; width: 34px; height: 34px;'>"},this.getInfoWindowContent=function(a){var b,c=new Date(a.create_date);return b=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate(),'<div class="panoramio-info-window"><div class="header">'+a.address+'</div><div class="body"><a href="'+this.ctx+"/photo/"+a.photo_id+'"><img src="'+this.ctx+"/api/rest/photo/"+a.photo_id+'/2"></a></div><div class="media"><a class="pull-left" href="'+this.ctx+"/user/"+a.user_id+'"><img class="media-object" src="'+this.ctx+"/api/rest/user/"+a.user_id+'/avatar" alt="'+a.username+'"></a><div class="media-body"><h4 class="media-heading">作者：<a href="'+this.ctx+"/user/"+a.user_id+'">'+a.username+"</a></h4>"+b+"</div></div></div>"},this.setMap=function(){},this.initEnv=function(a){this.ctx=a;var c=a+"/api/rest/panoramio/";jQuery.support.cors=!0,b=new jQuery.RestClient(c,{}),b.add("photo")},this.setUserId=function(a){this.opts.userId=a},this.getUserId=function(){return this.opts.userId},this.setTag=function(a){this.opts.tag=a},this.getTag=function(){return this.opts.tag},this.setFavorite=function(a){this.opts.favorite=!!a},this.getFavorite=function(){return this.opts.favorite},this.setLatest=function(a){this.opts.latest=!!a},this.getLatest=function(){return this.opts.latest},this.trigger=function(){}},a.cnmap.Panoramio});